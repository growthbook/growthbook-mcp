import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";

export function registerExperimentPrompts({ server }: { server: McpServer }) {
  server.prompt(
    "experiment-analysis",
    "Analyze recent experiments and give me actionable advice",
    () => ({
      messages: [
        {
          role: "user",
          content: {
            type: "text",
            text: "Use GrowthBook to fetch my recent experiments. Analyze the experiments and tell me:\n\n1. Which experiment types are actually worth running vs. theater?\n\n2. What's the one pattern in our losses that we're blind to?\n\n3. If you could only run 3 experiments next quarter based on these results, what would they be and why?\n\n4. What's the biggest methodological risk in our current approach that could be invalidating results?\n\nBe specific. Use the actual data. Don't give me generic advice.",
          },
        },
      ],
    })
  );

  server.prompt(
    "growthbook-wrapped",
    "Analyze recent experiments and give me actionable advice",
    () => ({
      messages: [
        {
          role: "user",
          content: {
            type: "text",
            text: "Generate a 'GrowthBook Wrapped' year-in-review for my experimentation program. 1. Fetch all experiments from 2024 using get_experiments in 'summary' mode.\n\n  2. Use the returned data to present these metrics:\n\n     **From the summary stats directly:**\n     * Total stopped experiments analyzed: `total`\n     * Excluded experiments: `_meta.excluded.draft` drafts, `_meta.excluded.running` running\n     * Total users reached: `totalUsers`\n     * Win rate: `winRate` (percentage of stopped experiments marked as won)\n     * Average experiment duration: `avgDurationDays`\n     * Median duration: `medianDurationDays`\n     * Average lift for winners: `avgLiftWinners`\n     * SRM failure rate: `srmFailureRate`\n     * Guardrail regression rate: `guardrailRegressionRate`\n     * Experiment type from `byType`\n\n     **From byMonth breakdown:**\n     * Busiest month for experiment completions\n     * H1 vs H2 velocity comparison (sum experiments ended in Jan-Jun vs Jul-Dec)\n     * Monthly win rate trends\n\n     **From byProject breakdown:**\n     * Which project had the most experiments\n     * Which project had the highest win rate\n\n     **From byTag breakdown:**\n     * Most common experiment tags\n     * Win rates by tag\n\n     **From topWinners/topLosers:**\n     * Biggest winner: first item in `topWinners` with highest lift\n     * Biggest loser: first item in `topLosers`\n     * Top 3 winners with their lift percentages\n\n     **From experiments array:**\n     * Count of experiments with SRM issues (`srmPassing === false`)\n     * Count with guardrail regressions\n     \n     **Fun Facts:**\n     * Longest running experiment\n     * Experiment with most users\n     * Most prolific experimenter (by owner)\n\n  3. Create an interactive React slideshow with a editorial, elegant, and modern style that presents these stats in a Spotify Wrapped format. Use bold typography, smooth transitions between slides, and celebrate both wins AND valuable learnings from losing experiments. Make it feel celebratory while highlighting the rigor and learning culture of the experimentation program.\n\n  4. For the shareable social card:\n     * Total experiments: use `total`\n     * Win rate: use `winRate` (format as percentage)\n     * Learning rate: calculate as `byVerdict.lost / total`\n     * Inconclusive rate: `byVerdict.inconclusive / total`\n     * Never show specific experiment names or hypotheses in shareable content\n     * Never show exact user counts (use \"thousands\" or \"millions\")\n     * Never show project names\n     * OK to show: percentages, counts, relative comparisons\n     * Include: \"Powered by GrowthBook\" with the provided logo\n\n  \n     data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='151' height='24' viewBox='0 0 151 24' fill='none'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M26.7949 13.6963C26.7949 18.5818 30.4643 21.7842 34.9751 21.7842C37.6863 21.7842 39.8599 20.6624 41.4024 18.9559V13.112H34.0168V15.5197H38.6679V17.9507C37.9668 18.6052 36.5645 19.353 34.9751 19.353C31.8901 19.353 29.5996 16.9686 29.5996 13.6961C29.5996 10.4235 31.89 8.06264 34.9751 8.06264C35.7661 8.06216 36.5457 8.25071 37.2491 8.61259C37.9524 8.97447 38.5591 9.4992 39.0185 10.1431L41.2622 8.88097C40.0001 7.08103 38.0135 5.63184 34.9751 5.63184C30.4643 5.63192 26.7949 8.81095 26.7949 13.6963ZM43.48 21.4803H45.934V13.7899C46.4249 12.9951 47.8038 12.2939 48.8322 12.2939C49.091 12.2896 49.3496 12.3131 49.6034 12.364V9.93296C48.131 9.93296 46.7754 10.7744 45.934 11.8498V10.1901H43.48V21.4803ZM55.9826 21.7608C59.6053 21.7608 61.8022 19.0727 61.8022 15.8235C61.8022 12.5977 59.6052 9.90956 55.9826 9.90956C52.4067 9.90956 50.1863 12.5977 50.1863 15.8235C50.1863 19.0727 52.4066 21.7608 55.9826 21.7608ZM55.9826 19.5872C53.9025 19.5872 52.7338 17.8344 52.7338 15.8238C52.7338 13.8369 53.9025 12.0838 55.9826 12.0838C58.0861 12.0838 59.2546 13.8367 59.2546 15.8238C59.2546 17.8338 58.0861 19.5872 55.9826 19.5872ZM73.4161 21.4803H75.9871L79.4928 10.1901H76.9455L75.7536 14.2924L74.5616 18.3948L71.8736 10.1901H69.7237L67.0359 18.3948L64.652 10.1901H62.1041L65.6098 21.4803H68.1811L70.7988 13.2055L73.4161 21.4803ZM83.8842 21.7608C85.0295 21.7608 85.7539 21.4569 86.198 21.0362L85.6135 19.1892C85.4266 19.3996 84.9825 19.5866 84.5151 19.5866C83.8139 19.5866 83.44 19.0257 83.44 18.2544V12.3406H85.7304V10.1901H83.44V7.10496H80.9859V10.1905H79.1163V12.341H80.9859V18.8623C80.9859 20.7323 81.9911 21.7608 83.8842 21.7608ZM94.8911 21.4803H97.3451V13.486C97.3451 11.1722 96.1298 9.90956 93.6991 9.90956C91.9228 9.90956 90.4504 10.8446 89.7026 11.7326V5.88898H87.2485V21.4803H89.7026V13.6029C90.2869 12.8316 91.362 12.0835 92.6007 12.0835C93.9797 12.0835 94.8912 12.6211 94.8912 14.3743L94.8911 21.4803ZM99.8906 21.4803H107.767C110.688 21.4803 112.301 19.6801 112.301 17.2728C112.301 15.3561 110.945 13.6963 109.286 13.4393C110.735 13.1354 111.997 11.8266 111.997 9.86285C111.997 7.66553 110.408 5.88898 107.557 5.88898H99.8907L99.8906 21.4803ZM102.625 12.3406V8.29665H106.996C108.398 8.29665 109.193 9.16152 109.193 10.33C109.193 11.4985 108.398 12.3402 106.996 12.3402L102.625 12.3406ZM102.625 19.0727V14.7482H107.112C108.678 14.7482 109.496 15.7299 109.496 16.8988C109.496 18.2545 108.608 19.0723 107.112 19.0723L102.625 19.0727ZM119.357 21.7608C122.98 21.7608 125.177 19.0727 125.177 15.8235C125.177 12.5977 122.98 9.90956 119.357 9.90956C115.781 9.90956 113.56 12.5977 113.56 15.8235C113.56 19.0727 115.781 21.7608 119.357 21.7608ZM119.357 19.5872C117.277 19.5872 116.108 17.8344 116.108 15.8238C116.108 13.8369 117.277 12.0838 119.357 12.0838C121.461 12.0838 122.629 13.8367 122.629 15.8238C122.629 17.8338 121.461 19.5872 119.357 19.5872ZM132.046 21.7608C135.669 21.7608 137.866 19.0727 137.866 15.8235C137.866 12.5977 135.669 9.90956 132.046 9.90956C128.47 9.90956 126.25 12.5977 126.25 15.8235C126.25 19.0727 128.47 21.7608 132.046 21.7608ZM132.046 19.5872C129.966 19.5872 128.797 17.8344 128.797 15.8238C128.797 13.8369 129.966 12.0838 132.046 12.0838C134.15 12.0838 135.318 13.8367 135.318 15.8238C135.318 17.8338 134.15 19.5872 132.046 19.5872ZM147.119 21.4803H150.204L145.413 15.3092L150.111 10.1901H147.073L142.094 15.6365V5.88898H139.64V21.4803H142.094V18.4416L143.66 16.8289L147.119 21.4803Z' fill='white'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M8.12201 8.36641L22.7947 0.110352C22.7947 0.110352 21.4115 1.3272 21.4723 3.96125C21.5371 6.7684 22.7947 7.81224 22.7947 7.81224L21.0706 7.02669L7.57344 12.3105C7.57344 12.3105 7.24575 11.3924 7.2404 10.7003C7.22647 8.99298 8.12201 8.36641 8.12201 8.36641Z' fill='white'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M5.00091 13.7634L21.0318 7.89941C21.0318 7.89941 19.6485 9.11626 19.7094 11.7504C19.7742 14.5575 21.0318 15.6013 21.0318 15.6013L18.7922 14.7391L4.40344 17.5715C4.40344 17.5715 4.12439 16.7252 4.1193 16.0973C4.10546 14.3899 5.00091 13.7634 5.00091 13.7634Z' fill='white'/%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M1.88177 18.5192L18.796 15.4849C18.796 15.4849 17.4127 16.7018 17.4735 19.3358C17.5384 22.143 18.796 23.1868 18.796 23.1868H2.00806C2.00806 23.1868 1.01488 22.5835 1.00016 20.7655C0.986312 19.0581 1.88177 18.5192 1.88177 18.5192Z' fill='white'/%3E%3Cscript xmlns=''/%3E%3C/svg%3E",
          },
        },
      ],
    })
  );
}
